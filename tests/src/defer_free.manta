// examples/defer_free.manta

// WriteAndCleanup is the return type for the write_and_cleanup function
type WriteAndCleanup enum {
    Ok
    IOError
}

// write_and_cleanup writes the contents of the file at the given path to a temporary buffer
fn write_and_cleanup(path str) WriteAndCleanup {
    try .Ok(f) := open(path) catch { return .IOError }
    defer { close(f) }

    buf := new([]u8, 256)
    defer { free(buf) }

    try .Ok(n) := write(f, buf) catch { return .IOError }
    return .Ok
}
